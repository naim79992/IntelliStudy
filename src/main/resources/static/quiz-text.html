<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IntelliStudy - Quiz from Text</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Custom CSS -->
 <link rel="stylesheet" href="css/quiz-text.css">


</head>
<body>

<!-- Full-width Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary text-white fixed-top" style="height:80px;">
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html">IntelliStudy</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="summarize.html">Summarize</a></li>
        <li class="nav-item"><a class="nav-link" href="translate.html">Translate</a></li>
        <li class="nav-item"><a class="nav-link" href="quiz.html">Quiz by Topic</a></li>
        <li class="nav-item"><a class="nav-link active" href="quiz-text.html">Quiz from Text</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container my-5">
    <h1 class="section-header">Generate Quiz from Your Text</h1>

    <textarea id="quizTextInput" class="form-control mb-3" rows="6" placeholder="Paste your text here..."></textarea>
    <button class="btn btn-info mb-3" onclick="loadQuizFromText()">Generate Quiz from Text</button>

    <form id="quizTextForm"></form>
    <button class="btn btn-success mt-2" id="submitQuizTextBtn" onclick="submitQuizFromText()" style="display:none;">Submit Exam</button>
    <!-- <pre class="mt-3" id="quizTextResult"></pre> -->
    <pre class="mt-3" id="quizTextResult">Your score will appear here</pre>

</div>

<footer class="bg-primary text-white py-3 mt-5">
  <div class="container-fluid text-center"><p class="mb-0">Â© 2025 IntelliStudy</p></div>
</footer>

<script>
const BASE_URL = "/api/gemini";
let currentQuizFromText = [];

async function loadQuizFromText() {
    const text = document.getElementById("quizTextInput").value;
    if(!text.trim()){ alert("Please paste some text!"); return; }

    try {
        const res = await fetch(`${BASE_URL}/quiz/text-json`, {
            method: "POST",
            headers: {"Content-Type": "text/plain"},
            body: text
        });
        const data = await res.json();
        currentQuizFromText = data;
        renderQuiz(currentQuizFromText, "quizTextForm", "qt", "submitQuizTextBtn", "quizTextResult");
    } catch(err){
        console.error("Error:", err);
        alert("Failed to generate quiz. Check your backend.");
    }
}

function renderQuiz(quizData, formId, prefix, submitBtnId, resultId) {
    const form = document.getElementById(formId);
    form.innerHTML = "";
    quizData.forEach((q, i) => {
        const div = document.createElement("div");
        div.classList.add("mb-3");
        div.innerHTML = `<p><strong>${i+1}. ${q.question}</strong></p>`;
        q.options.forEach(opt => {
            div.innerHTML += `<div class="form-check">
                <input class="form-check-input" type="radio" name="${prefix}${i}" value="${opt}" id="${prefix}${i}-${opt}">
                <label class="form-check-label" for="${prefix}${i}-${opt}">${opt}</label>
            </div>`;
        });
        form.appendChild(div);
    });
    document.getElementById(submitBtnId).style.display = "inline-block";
    document.getElementById(resultId).textContent = "";
}

function submitQuizFromText() {
    let score = 0;
    currentQuizFromText.forEach((q, i) => {
        const selected = document.querySelector(`input[name="qt${i}"]:checked`);
        if(selected && selected.value === q.answer) score++;
    });
    document.getElementById("quizTextResult").textContent = `Your score: ${score} / ${currentQuizFromText.length}`;
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
